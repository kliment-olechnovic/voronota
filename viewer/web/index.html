<!doctype html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>voronota-viewer</title>
		
		<style>
			body
			{
				font-family: arial;
				margin: 0;
				padding: none;
			}
	
			canvas.emscripten
			{
				border: 0px none;
				background-color: black;
			}
			
			.layout-row
			{
				display: flex;
			}
			
			#controls
			{
				bottom: 0;
				left: 0;
				position: absolute;
				margin: 0;
				padding: none;
				width: 20em;
			}
		</style>
	</head>
	
	<body>

		<div>
			<canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
			<p id="controls">
				<input type="file" id="file_input" style="display: none;"/>
				<button onclick="document.getElementById('file_input').click();">Import file</button>
				<button onclick="load_input_file_from_PDB()">Fetch from PDB</button>
			</p>
		</div>
		
		<script type='text/javascript'>
			var Module = {
				preRun: [],
				postRun: [(function(){on_update_window_size();})],
				arguments: ['--window-width', '500', '--window-height', '500'],
				print: (function()
				{
					return function(text)
					{
						console.log(text);
					};
				})(),
				canvas: (function()
				{
					var canvas = document.getElementById('canvas');
					canvas.addEventListener("webglcontextlost", function(e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);
					return canvas;
				})()
			};
		</script>
		
		<script type='text/javascript'>
			function on_update_window_size()
			{
				var new_width=window.innerWidth;
				if(new_width<500)
				{
					new_width=500;
				}
				var new_heigth=window.innerHeight-40;
				if(new_heigth<500)
				{
					new_heigth=500;
				}
				voronota_viewer_resize_window(new_width, new_heigth);
			}
			
			window.addEventListener('resize', function(event){on_update_window_size()});
		</script>
		
		<script type='text/javascript'>
			function voronota_viewer_enqueue_script(str)
			{
				Module.ccall('voronota_viewer_enqueue_script', null, ['string'], [str]);
			}
			
			function voronota_viewer_execute_native_script(str)
			{
				var result=JSON.parse(Module.ccall('voronota_viewer_execute_native_script', 'string', ['string'], [str]));
				return result;
			}
			
			function voronota_viewer_get_last_script_output()
			{
				var result=JSON.parse(Module.ccall('voronota_viewer_get_last_script_output', 'string'));
				return result;
			}
			
			function voronota_viewer_upload_file(name, data)
			{
				Module.ccall('voronota_viewer_upload_file', null, ['string','string'], [name,data]);
			}
			
			function voronota_viewer_resize_window(width, height)
			{
				Module.ccall('voronota_viewer_resize_window', null, ['int','int'], [width,height]);
			}
		</script>
		
		<script type='text/javascript'>
			var script = document.createElement('script');
			script.src = "2zsk.js";
			document.body.appendChild(script);
		</script>

		<script type='text/javascript'>
			var script = document.createElement('script');
			script.src = "voronota_viewer.js";
			document.body.appendChild(script);
		</script>
		
		<script type='text/javascript'>
			var file_input=document.getElementById('file_input');
			file_input.addEventListener('change', function(e)
			{
				var file=file_input.files[0];
				var file_reader=new FileReader();
				file_reader.onloadend=function(e){voronota_viewer_upload_file(file.name, file_reader.result);}
				file_reader.readAsText(file);	
			});
		</script>
		
		<script type='text/javascript'>
			function load_input_file_from_PDB()
			{
				var pdb_id=prompt('Enter PDB ID', '1T3Y');
				var pdb_url='https://files.rcsb.org/download/'+pdb_id+'.pdb';
				var file_reader=new FileReader();
				file_reader.onloadend=function(e){voronota_viewer_upload_file(pdb_id+'.pdb', file_reader.result);}
				var xhr=new XMLHttpRequest();
				xhr.open('GET', pdb_url);
				xhr.responseType='blob';
				xhr.onload=function()
				{
					file_reader.readAsText(xhr.response);
				}
				xhr.send();
			}
		</script>

	</body>
</html>
