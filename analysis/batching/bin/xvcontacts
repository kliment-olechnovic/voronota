#!/bin/bash

readonly BINDIR=/scratch/lustre/home/kliment/voronota_esp/extbin

readonly OUTPUTDIR=$1
readonly INPUTFILE=$2

readonly INPUTBASENAME=$(basename $INPUTFILE)

mkdir -p $OUTPUTDIR/vballs
mkdir -p $OUTPUTDIR/vcontacts

/scratch/lustre/home/kliment/voronota_esp/extbin/voronota $INPUTFILE > $OUTPUTDIR/dssp/$(basename $INPUTFILE)

cat $INPUTFILE \
| $BINDIR/voronota get-balls-from-atoms-file --radii-file $BINDIR/radii --annotated \
| $BINDIR/voronota query-balls --drop-altloc-indicators --drop-atom-serials \
| sed 's/A<OXT>/A<O>/g' \
| tee $OUTPUTDIR/vballs/$INPUTBASENAME \
| $BINDIR/voronota calculate-contacts --annotated \
> $OUTPUTDIR/vcontacts/$INPUTBASENAME
