#!/bin/bash

readonly BINDIR=$1
readonly OUTPUTDIR=$2
readonly INPUTFILE=$3

readonly INPUTBASENAME=$(basename $INPUTFILE)

mkdir -p $OUTPUTDIR/vballs
mkdir -p $OUTPUTDIR/vcontacts

cat $INPUTFILE \
| $BINDIR/voronota get-balls-from-atoms-file --radii-file $BINDIR/radii --annotated \
| $BINDIR/voronota query-balls --drop-altloc-indicators --drop-atom-serials --drop-adjuncts --drop-tags \
| sed 's/A<OXT>/A<O>/g' \
| tee $OUTPUTDIR/vballs/$INPUTBASENAME \
| $BINDIR/voronota calculate-contacts --annotated \
> $OUTPUTDIR/vcontacts/$INPUTBASENAME
